<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Lab - Project H</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* ------------------------- */
        /* --- 글로벌 스타일 & 변수 --- */
        /* ------------------------- */
        :root {
            --bg-color: #121212;
            --surface-color: #1e1e1e;
            --primary-color: #03dac6;
            --primary-variant-color: #3700b3;
            --secondary-color: #bb86fc;
            --text-color: #e0e0e0;
            --text-secondary-color: #a0a0a0;
            --border-color: #333333;
            --success-color: #4caf50;
            --error-color: #f44336;
            --font-family: 'Noto Sans KR', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            font-size: 16px;
        }

       .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1, h2, h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        /* ------------------------- */
        /* --- 내비게이션 & 레이아웃 --- */
        /* ------------------------- */
       .main-nav {
            display: flex;
            gap: 1rem;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 2rem;
        }

       .nav-tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--text-secondary-color);
            font-size: 1rem;
            font-weight: 500;
            transition: color 0.3s, border-bottom 0.3s;
            border-bottom: 3px solid transparent;
        }

       .nav-tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

       .module {
            display: none;
            animation: fadeIn 0.5s;
        }

       .module.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ------------------------- */
        /* --- 공용 컴포넌트 (폼, 버튼 등) --- */
        /* ------------------------- */
       .card {
            background-color: var(--surface-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

       .form-group {
            margin-bottom: 1rem;
        }

       .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary-color);
            font-weight: 500;
        }

       .form-control {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-color);
            font-size: 1rem;
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
       .tag-group label {
            margin-right: 1rem;
        }

       .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: background-color 0.3s, transform 0.1s;
        }

       .btn-primary {
            background-color: var(--primary-color);
            color: #000;
        }

       .btn-primary:hover {
            background-color: #3cfddc;
        }
        
       .btn:active {
            transform: translateY(1px);
        }

       .btn-secondary {
            background-color: var(--secondary-color);
            color: #000;
        }
        
       .btn-secondary:hover {
            background-color: #d0aaff;
        }

       .list-group {
            list-style: none;
            padding: 0;
        }

       .list-group-item {
            background-color: var(--bg-color);
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ------------------------- */
        /* --- 모듈 4: 대시보드 스타일 --- */
        /* ------------------------- */
       .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

       .stat-card h3 {
            color: var(--secondary-color);
            font-size: 1.2rem;
        }

       .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-color);
        }

       .xp-bar-container {
            width: 100%;
            height: 25px;
            background-color: var(--bg-color);
            border-radius: 12.5px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            margin-top: 0.5rem;
        }

       .xp-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary-variant-color), var(--secondary-color));
            border-radius: 12.5px;
            transition: width 0.5s ease-in-out;
            text-align: center;
            line-height: 25px;
            color: #fff;
            font-weight: bold;
        }
        
       .xp-text {
            margin-top: 0.5rem;
            text-align: right;
            color: var(--text-secondary-color);
        }

        /* ------------------------- */
        /* --- 모듈 3: 챌린지 스타일 --- */
        /* ------------------------- */
       .challenge-item-completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

       .challenge-item-completed.btn {
            background-color: var(--success-color);
            cursor: not-allowed;
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Speech Lab <span style="color: var(--text-secondary-color); font-size: 1.2rem;">(Project H)</span></h1>
            <nav class="main-nav">
                <button class="nav-tab active" data-tab="dashboard">대시보드</button>
                <button class="nav-tab" data-tab="library">콘텐츠 라이브러리</button>
                <button class="nav-tab" data-tab="analyzer">'쪼개기' 분석기</button>
                <button class="nav-tab" data-tab="challenges">챌린지</button>
            </nav>
        </header>

        <main>
            <div id="dashboard-module" class="module active">
                <h2>나의 성장 대시보드</h2>
                <div class="dashboard-grid">
                    <div class="card stat-card">
                        <h3>Level</h3>
                        <p class="stat-value" id="level-display">1</p>
                    </div>
                    <div class="card stat-card">
                        <h3>XP (경험치)</h3>
                        <p class="stat-value" id="xp-display">0</p>
                        <div class="xp-bar-container">
                            <div id="xp-bar" class="xp-bar"></div>
                        </div>
                        <p class="xp-text" id="xp-text-display">0 / 1000</p>
                    </div>
                </div>
                <div class="card">
                    <h3>Skill Tree (스킬 분석 현황)</h3>
                    <canvas id="skillTreeChart"></canvas>
                </div>
            </div>

            <div id="library-module" class="module">
                <h2>콘텐츠 라이브러리</h2>
                <div class="card">
                    <h3>새 콘텐츠 추가</h3>
                    <form id="add-content-form">
                        <div class="form-group">
                            <label for="content-title">영상 제목</label>
                            <input type="text" id="content-title" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="content-url">원본 URL</label>
                            <input type="url" id="content-url" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="content-type">유형</label>
                            <select id="content-type" class="form-control">
                                <option value="풀 영상">풀 영상</option>
                                <option value="쇼츠">쇼츠</option>
                                <option value="강의">강의</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="content-category">카테고리</label>
                            <select id="content-category" class="form-control">
                                <option value="논리적 말하기">논리적 말하기</option>
                                <option value="호감형 말하기">호감형 말하기</option>
                                <option value="스킬">스킬</option>
                                <option value="감정">감정</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">라이브러리에 추가 (+10 XP)</button>
                    </form>
                </div>
                <div class="card">
                    <h3>콘텐츠 목록</h3>
                    <ul id="content-list" class="list-group">
                        </ul>
                </div>
            </div>

            <div id="analyzer-module" class="module">
                <h2>'쪼개기' 분석기</h2>
                <div class="card">
                    <form id="decon-note-form">
                        <div class="form-group">
                            <label for="linked-content">분석할 콘텐츠 선택</label>
                            <select id="linked-content" class="form-control" required>
                                </select>
                        </div>
                        <div class="form-group">
                            <label for="original-script">원본 스크립트</label>
                            <textarea id="original-script" class="form-control" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="analysis-intent">의도 분석 (Why?)</label>
                            <input type="text" id="analysis-intent" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="analysis-technique">기법 분석 (How?)</label>
                            <input type="text" id="analysis-technique" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="analysis-emotion">감정 분석</label>
                            <input type="text" id="analysis-emotion" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="analysis-keywords">핵심 키워드</label>
                            <input type="text" id="analysis-keywords" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="my-rewriting">나의 리라이팅</label>
                            <textarea id="my-rewriting" class="form-control"></textarea>
                        </div>
                        <div class="form-group tag-group">
                            <label>스킬 태그 (Skill Tree 연동)</label><br>
                            <input type="checkbox" id="tag-logic" name="skill-tag" value="logic"> <label for="tag-logic">논리</label>
                            <input type="checkbox" id="tag-appeal" name="skill-tag" value="appeal"> <label for="tag-appeal">호감</label>
                            <input type="checkbox" id="tag-skill" name="skill-tag" value="skill"> <label for="tag-skill">스킬</label>
                        </div>
                        <button type="submit" class="btn btn-primary">쪼개기 노트 제출 (+50 XP)</button>
                    </form>
                </div>
                 <div class="card">
                    <h3>최근 분석 노트</h3>
                    <ul id="analysis-note-list" class="list-group">
                        </ul>
                </div>
            </div>

            <div id="challenges-module" class="module">
                <h2>'점진적 과부하' 챌린지</h2>
                <div class="card">
                    <ul id="challenge-list" class="list-group">
                        </ul>
                </div>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ------------------------------------
        // --- 1. 상태 관리 (State Management) ---
        // ------------------------------------

        // 애플리케이션의 모든 데이터를 담는 단일 소스(Single Source of Truth)
        let appState = {
            contentLibrary:,
            analysisNotes:,
            challenges: [
                { id: 1, level: 1, description: "흥버튼 영상 1분 '쉐도잉' 녹음", xp: 100, completed: false },
                { id: 2, level: 5, description: "'쪼개기 노트' 10개 작성하기", xp: 150, completed: false },
                { id: 3, level: 10, description: "분석한 '기법' 1개 활용하여 1분 영상 녹화", xp: 200, completed: false },
                { id: 4, level: 20, description: "주제 스피치(3분) 녹화 (흥버튼 스타일 적용)", xp: 300, completed: false },
            ],
            playerStats: {
                xp: 0,
                level: 1,
                skillTree: {
                    logic: 0,
                    appeal: 0,
                    skill: 0,
                },
            },
        };

        // 레벨업에 필요한 XP 테이블
        const XP_PER_LEVEL = 1000;

        // localStorage에서 상태 불러오기
        function loadState() {
            const savedState = localStorage.getItem('speechLabState');
            if (savedState) {
                appState = JSON.parse(savedState);
            }
        }

        // localStorage에 상태 저장하기
        function saveState() {
            localStorage.setItem('speechLabState', JSON.stringify(appState));
        }

        // ------------------------------------
        // --- 2. DOM 요소 캐싱 ---
        // ------------------------------------
        const tabs = document.querySelectorAll('.nav-tab');
        const modules = document.querySelectorAll('.module');

        // 모듈 1: 라이브러리
        const addContentForm = document.getElementById('add-content-form');
        const contentList = document.getElementById('content-list');

        // 모듈 2: 분석기
        const deconNoteForm = document.getElementById('decon-note-form');
        const linkedContentSelect = document.getElementById('linked-content');
        const analysisNoteList = document.getElementById('analysis-note-list');

        // 모듈 3: 챌린지
        const challengeList = document.getElementById('challenge-list');

        // 모듈 4: 대시보드
        const levelDisplay = document.getElementById('level-display');
        const xpDisplay = document.getElementById('xp-display');
        const xpBar = document.getElementById('xp-bar');
        const xpTextDisplay = document.getElementById('xp-text-display');
        const skillTreeChartCanvas = document.getElementById('skillTreeChart').getContext('2d');
        let skillTreeChart;


        // ------------------------------------
        // --- 3. 핵심 로직 (Controllers) ---
        // ------------------------------------

        // XP 추가 및 레벨업 체크
        function addXp(amount) {
            appState.playerStats.xp += amount;
            checkForLevelUp();
        }

        // 레벨업 로직
        function checkForLevelUp() {
            const currentLevel = appState.playerStats.level;
            const currentXp = appState.playerStats.xp;
            const xpForNextLevel = currentLevel * XP_PER_LEVEL;
            
            if (currentXp >= xpForNextLevel) {
                appState.playerStats.level++;
                // 레벨업 시 알림 등 추가 가능
                alert(`🎉 레벨 업! 축하합니다! Level ${appState.playerStats.level} 달성!`);
            }
        }

        // 모듈 1: 콘텐츠 추가
        function handleAddContent(e) {
            e.preventDefault();
            const title = document.getElementById('content-title').value;
            const url = document.getElementById('content-url').value;
            const type = document.getElementById('content-type').value;
            const category = document.getElementById('content-category').value;

            const newContent = {
                id: Date.now(),
                title, url, type, category
            };

            appState.contentLibrary.push(newContent);
            addXp(10); // 콘텐츠 추가 시 +10 XP
            
            saveState();
            render();
            addContentForm.reset();
        }

        // 모듈 2: 쪼개기 노트 제출
        function handleSubmitNote(e) {
            e.preventDefault();
            
            const selectedTags = Array.from(document.querySelectorAll('input[name="skill-tag"]:checked')).map(el => el.value);
            
            const newNote = {
                id: Date.now(),
                contentId: document.getElementById('linked-content').value,
                script: document.getElementById('original-script').value,
                intent: document.getElementById('analysis-intent').value,
                technique: document.getElementById('analysis-technique').value,
                emotion: document.getElementById('analysis-emotion').value,
                keywords: document.getElementById('analysis-keywords').value,
                rewriting: document.getElementById('my-rewriting').value,
                tags: selectedTags
            };

            appState.analysisNotes.push(newNote);
            addXp(50); // 노트 제출 시 +50 XP

            // Skill Tree 업데이트
            newNote.tags.forEach(tag => {
                if (appState.playerStats.skillTree.hasOwnProperty(tag)) {
                    appState.playerStats.skillTree[tag]++;
                }
            });

            saveState();
            render();
            deconNoteForm.reset();
        }

        // 모듈 3: 챌린지 완료
        function handleCompleteChallenge(challengeId) {
            const challenge = appState.challenges.find(c => c.id === challengeId);
            if (challenge &&!challenge.completed) {
                challenge.completed = true;
                addXp(challenge.xp); // 챌린지 완료 시 정해진 XP 획득

                saveState();
                render();
            }
        }


        // ------------------------------------
        // --- 4. 렌더링 (Views) ---
        // ------------------------------------

        // 마스터 렌더링 함수: 모든 UI 업데이트를 총괄
        function render() {
            renderDashboard();
            renderLibrary();
            renderAnalyzer();
            renderChallenges();
        }

        // 대시보드 렌더링
        function renderDashboard() {
            const stats = appState.playerStats;
            const xpForCurrentLevel = (stats.level - 1) * XP_PER_LEVEL;
            const xpForNextLevel = stats.level * XP_PER_LEVEL;
            const xpProgress = stats.xp - xpForCurrentLevel;
            const xpNeeded = xpForNextLevel - xpForCurrentLevel;
            const progressPercentage = Math.min(100, (xpProgress / xpNeeded) * 100);

            levelDisplay.textContent = stats.level;
            xpDisplay.textContent = stats.xp.toLocaleString();
            xpBar.style.width = `${progressPercentage}%`;
            xpBar.textContent = `${Math.round(progressPercentage)}%`;
            xpTextDisplay.textContent = `${stats.xp.toLocaleString()} / ${xpForNextLevel.toLocaleString()}`;

            // 스킬 트리 차트 업데이트
            skillTreeChart.data.datasets.data =;
            skillTreeChart.update();
        }

        // 라이브러리 렌더링
        function renderLibrary() {
            contentList.innerHTML = '';
            if (appState.contentLibrary.length === 0) {
                contentList.innerHTML = '<p>아직 추가된 콘텐츠가 없습니다.</p>';
                return;
            }
            appState.contentLibrary.forEach(content => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.innerHTML = `
                    <div>
                        <strong>${content.title}</strong>
                        <small style="color: var(--text-secondary-color); display: block;">${content.category} / ${content.type}</small>
                    </div>
                    <a href="${content.url}" target="_blank" class="btn btn-secondary">영상 보기</a>
                `;
                contentList.appendChild(li);
            });
        }
        
        // 분석기 렌더링 (콘텐츠 선택 옵션 및 최근 노트)
        function renderAnalyzer() {
            // 콘텐츠 선택 드롭다운 채우기
            linkedContentSelect.innerHTML = '';
            appState.contentLibrary.forEach(content => {
                const option = document.createElement('option');
                option.value = content.id;
                option.textContent = content.title;
                linkedContentSelect.appendChild(option);
            });

            // 최근 분석 노트 5개 표시
            analysisNoteList.innerHTML = '';
            const recentNotes =.reverse().slice(0, 5);
            if (recentNotes.length === 0) {
                analysisNoteList.innerHTML = '<p>아직 작성된 분석 노트가 없습니다.</p>';
                return;
            }
            recentNotes.forEach(note => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                const linkedContent = appState.contentLibrary.find(c => c.id == note.contentId);
                li.innerHTML = `
                    <div>
                        <strong>"${note.script.substring(0, 30)}..."</strong>
                        <small style="color: var(--text-secondary-color); display: block;">
                            분석 영상: ${linkedContent? linkedContent.title : '알 수 없음'}
                        </small>
                    </div>
                    <div>${note.tags.map(t => `<span class="badge">${t}</span>`).join(' ')}</div>
                `;
                analysisNoteList.appendChild(li);
            });
        }


        // 챌린지 렌더링
        function renderChallenges() {
            challengeList.innerHTML = '';
            appState.challenges.forEach(challenge => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                if (challenge.completed) {
                    li.classList.add('challenge-item-completed');
                }
                li.innerHTML = `
                    <div>
                        <strong>Lv.${challenge.level}: ${challenge.description}</strong>
                        <small style="color: var(--text-secondary-color); display: block;">보상: ${challenge.xp} XP</small>
                    </div>
                    <button class="btn ${challenge.completed? '' : 'btn-secondary'}" data-challenge-id="${challenge.id}" ${challenge.completed? 'disabled' : ''}>
                        ${challenge.completed? '완료됨' : '완료'}
                    </button>
                `;
                challengeList.appendChild(li);
            });
        }

        // ------------------------------------
        // --- 5. 초기화 및 이벤트 리스너 ---
        // ------------------------------------

        // 스킬 트리 차트 초기화
        function initChart() {
            skillTreeChart = new Chart(skillTreeChartCanvas, {
                type: 'bar',
                data: {
                    labels: ['논리', '호감', '스킬'],
                    datasets: [{
                        label: '분석 횟수',
                        data: , // 초기 데이터는 appState에서 가져옴
                        backgroundColor: [
                            'rgba(3, 218, 198, 0.6)',
                            'rgba(187, 134, 252, 0.6)',
                            'rgba(55, 0, 179, 0.6)'
                        ],
                        borderColor: [
                            'rgba(3, 218, 198, 1)',
                            'rgba(187, 134, 252, 1)',
                            'rgba(55, 0, 179, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { color: var(--text-secondary-color) },
                            grid: { color: var(--border-color) }
                        },
                        y: {
                            ticks: { color: var(--text-color), font: { size: 14 } },
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    maintainAspectRatio: false
                }
            });
        }

        // 애플리케이션 초기화 함수
        function init() {
            loadState();
            initChart();

            // 탭 전환 로직
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    modules.forEach(m => m.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-module`).classList.add('active');
                });
            });

            // 폼 제출 이벤트 리스너
            addContentForm.addEventListener('submit', handleAddContent);
            deconNoteForm.addEventListener('submit', handleSubmitNote);

            // 챌린지 완료 버튼 이벤트 리스너 (이벤트 위임)
            challengeList.addEventListener('click', (e) => {
                if (e.target.matches('button[data-challenge-id]')) {
                    const challengeId = parseInt(e.target.dataset.challengeId);
                    handleCompleteChallenge(challengeId);
                }
            });

            // 초기 렌더링 실행
            render();
        }

        // 초기화 함수 호출
        init();
    });
    </script>
</body>
</html>